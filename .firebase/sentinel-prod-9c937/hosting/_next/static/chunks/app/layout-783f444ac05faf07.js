(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{9517:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6196,23)),Promise.resolve().then(r.t.bind(r,347,23)),Promise.resolve().then(r.bind(r,3645)),Promise.resolve().then(r.bind(r,4099)),Promise.resolve().then(r.bind(r,5502))},3645:(e,t,r)=>{"use strict";r.d(t,{PWAInstallPrompt:()=>i});var n=r(5155),a=r(2115);function i(){let{canInstall:e,installPWA:t,updatePWA:r,updateAvailable:i,isOffline:o}=function(){let[e,t]=(0,a.useState)({isInstallable:!1,isInstalled:!1,isOffline:!1,updateAvailable:!1,registration:null}),[r,n]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=()=>{let e=window.matchMedia("(display-mode: standalone)").matches,r=!0===window.navigator.standalone;t(t=>({...t,isInstalled:e||r}))};e();let r=window.matchMedia("(display-mode: standalone)");r.addListener(e);let a=e=>{e.preventDefault(),n(e),t(e=>({...e,isInstallable:!0}))},i=()=>{t(e=>({...e,isInstalled:!0,isInstallable:!1})),n(null)};window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",i);let o=()=>t(e=>({...e,isOffline:!1})),s=()=>t(e=>({...e,isOffline:!0}));return window.addEventListener("online",o),window.addEventListener("offline",s),t(e=>({...e,isOffline:!window.navigator.onLine})),"serviceWorker"in window.navigator&&window.navigator.serviceWorker.ready.then(e=>{t(t=>({...t,registration:e})),e.addEventListener("updatefound",()=>{let r=e.installing;r&&r.addEventListener("statechange",()=>{"installed"===r.state&&window.navigator.serviceWorker.controller&&t(e=>({...e,updateAvailable:!0}))})})}),()=>{r.removeListener(e),window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",i),window.removeEventListener("online",o),window.removeEventListener("offline",s)}},[]);let i=async()=>{if(!r)return!1;r.prompt();let{outcome:e}=await r.userChoice;return n(null),t(t=>({...t,isInstallable:!1,isInstalled:"accepted"===e})),"accepted"===e},o=async e=>{if("undefined"!=typeof navigator&&navigator.share)try{return await navigator.share({title:e.title||"Sentinel - Monitoreo de Desastres",text:e.text,url:e.url||window.location.href}),!0}catch(e){console.error("Error sharing:",e)}return!1};return{...e,installPWA:i,updatePWA:()=>{var t;(null===(t=e.registration)||void 0===t?void 0:t.waiting)&&(e.registration.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())},share:o,canInstall:e.isInstallable&&!!r,canShare:"undefined"!=typeof navigator&&!!navigator.share}}(),[s,l]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{if((e||i)&&!s){let e=setTimeout(()=>{l(!0)},1e4);return()=>clearTimeout(e)}},[e,i,s]),s)?null:i?(0,n.jsx)("div",{className:"fixed top-20 right-4 z-50 animate-slide-in-right",children:(0,n.jsxs)("div",{className:"bg-[#1A1B22]/90 backdrop-blur-md border border-[#D4B57A]/40 rounded-xl p-3 shadow-2xl flex items-center gap-4 min-w-[280px]",children:[(0,n.jsx)("div",{className:"bg-[#D4B57A]/20 p-2 rounded-lg",children:(0,n.jsx)("span",{className:"text-xl",children:"\uD83D\uDD04"})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-[#E8E8F0] font-semibold text-xs tracking-tight",children:"Actualizaci\xf3n disponible"}),(0,n.jsx)("p",{className:"text-[#8890A0] text-[10px] mt-0.5",children:"Nueva versi\xf3n de Sentinel"}),(0,n.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,n.jsx)("button",{onClick:r,className:"text-[10px] bg-[#D4B57A] text-[#0D0E14] px-3 py-1 rounded-md font-bold hover:bg-[#B89A5A] transition-colors",children:"Actualizar ahora"}),(0,n.jsx)("button",{onClick:()=>l(!0),className:"text-[10px] text-[#8890A0] hover:text-[#E8E8F0] px-2",children:"Despu\xe9s"})]})]})]})}):e?(0,n.jsx)("div",{className:"fixed top-20 right-4 z-50 animate-slide-in-right",children:(0,n.jsxs)("div",{className:"bg-[#1A1B22]/90 backdrop-blur-md border border-[#4A5060]/40 rounded-xl p-3 shadow-2xl flex items-center gap-4 min-w-[280px]",children:[(0,n.jsx)("div",{className:"bg-[#4A5060]/20 p-2 rounded-lg",children:(0,n.jsx)("span",{className:"text-xl",children:"\uD83D\uDCF1"})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-[#E8E8F0] font-semibold text-xs tracking-tight",children:"Sentinel Web App"}),(0,n.jsx)("p",{className:"text-[#8890A0] text-[10px] mt-0.5",children:"Instala para notificaciones"}),(0,n.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,n.jsx)("button",{onClick:t,className:"text-[10px] bg-[#E8E8F0] text-[#0D0E14] px-3 py-1 rounded-md font-bold hover:bg-[#C8C8D0] transition-colors",children:"Instalar"}),(0,n.jsx)("button",{onClick:()=>l(!0),className:"text-[10px] text-[#8890A0] hover:text-[#E8E8F0] px-2",children:"Ocultar"})]})]}),(0,n.jsx)("button",{onClick:()=>l(!0),className:"text-[#8890A0] hover:text-[#E8E8F0] p-1",children:"âœ•"})]})}):o?(0,n.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,n.jsxs)("div",{className:"bg-[#FBBF24]/10 border border-[#FBBF24]/30 rounded-lg px-4 py-2 flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDCE1"}),(0,n.jsx)("span",{className:"text-[#FBBF24] text-sm",children:"Modo offline"})]})}):null}},4099:(e,t,r)=>{"use strict";r.d(t,{Provider:()=>a});var n=r(5155);function a(e){let{children:t}=e;return(0,n.jsx)(n.Fragment,{children:t})}},3954:(e,t,r)=>{"use strict";r.d(t,{Bh:()=>c,CI:()=>l,G6:()=>s,mJ:()=>p,st:()=>u});var n=r(5877),a=r(7058),i=r(3090);let o=new n.HF;async function s(){try{let e=(await (0,n.df)(i.j2,o)).user,t={email:e.email,displayName:e.displayName||e.email.split("@")[0],photoURL:e.photoURL||void 0,fcmToken:void 0,settings:{language:"es",darkMode:!1,soundEnabled:!0},createdAt:new Date,updatedAt:new Date};return await (0,a.setDoc)((0,a.doc)(i.db,"users",e.uid),{...t,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()},{merge:!0}),{uid:e.uid,...t}}catch(e){throw console.error("Error signing in with Google:",e),function(e){switch(e.code){case"auth/popup-closed-by-user":return Error("Inicio de sesi\xf3n cancelado");case"auth/popup-blocked":return Error("Popup bloqueado por el navegador");case"auth/network-request-failed":return Error("Error de conexi\xf3n");case"auth/too-many-requests":return Error("Demasiados intentos. Int\xe9ntalo m\xe1s tarde");default:return Error("Error al iniciar sesi\xf3n")}}(e)}}async function l(){try{await (0,n.CI)(i.j2)}catch(e){throw console.error("Error signing out:",e),Error("Error al cerrar sesi\xf3n")}}function c(e){return(0,n.hg)(i.j2,async t=>{if(t)try{let r=await d(t.uid);e(r)}catch(t){console.error("Error getting user data:",t),e(null)}else e(null)})}async function d(e){try{let a=await Promise.resolve().then(r.bind(r,7058)).then(t=>{let{getDoc:r,doc:n}=t;return r(n(i.db,"users",e))});if(a.exists()){var t,n;let r=a.data();return{uid:e,email:r.email,displayName:r.displayName,photoURL:r.photoURL,fcmToken:r.fcmToken,settings:r.settings||{language:"es",darkMode:!1,soundEnabled:!0},createdAt:(null===(t=r.createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(n=r.updatedAt)||void 0===n?void 0:n.toDate())||new Date}}return null}catch(e){return console.error("Error getting user data:",e),null}}async function u(e,t){try{await Promise.resolve().then(r.bind(r,7058)).then(async r=>{let{updateDoc:n,doc:a,serverTimestamp:o}=r;await n(a(i.db,"users",e),{fcmToken:t,updatedAt:o()})})}catch(e){console.error("Error updating FCM token:",e)}}async function p(e,t){try{await Promise.resolve().then(r.bind(r,7058)).then(async r=>{let{updateDoc:n,doc:a,serverTimestamp:o}=r;await n(a(i.db,"users",e),{settings:t,updatedAt:o()})})}catch(e){throw console.error("Error updating user settings:",e),Error("Error al actualizar configuraci\xf3n")}}o.setCustomParameters({prompt:"select_account"})},3090:(e,t,r)=>{"use strict";r.d(t,{H9:()=>p,JQ:()=>u,db:()=>d,j2:()=>c});var n=r(9904),a=r(5877),i=r(7058),o=r(8359);let s={apiKey:"AIzaSyDp2z1FBMgNWJeAhOuOXgrglx9yFf_ras8",authDomain:"sentinel-prod-9c937.firebaseapp.com",projectId:"sentinel-prod-9c937",storageBucket:"sentinel-prod-9c937.firebasestorage.app",messagingSenderId:"846642937822",appId:"1:846642937822:web:b0db6f6c5f3db4c3d3274f"};if(!s.apiKey||!s.projectId)throw console.error("Firebase config incomplete:",{hasApiKey:!!s.apiKey,hasProjectId:!!s.projectId,hasAuthDomain:!!s.authDomain}),Error("Firebase configuration is incomplete. Check environment variables.");let l=0===(0,n.Dk)().length?(0,n.Wp)(s):(0,n.Dk)()[0],c=(0,a.xI)(l),d=(0,i.getFirestore)(l);console.log("Firebase initialized:",{projectId:s.projectId,hasAuth:!!c,hasDb:!!d});let u="BHOX3qNmiQt7WlXM0ZxYlWlmiAIgK-bJxzfexJ6rRQYwPjNnrc-XMxIvkwyakuJ2hLGiCSl8KM-mueYni4fL9zc";async function p(){try{if(!await (0,o.TT)())return console.warn("Firebase Messaging no est\xe1 soportado en este navegador"),null;let e=(0,o.dG)(l);if("serviceWorker"in navigator){let e=await navigator.serviceWorker.register("/firebase-messaging-sw.js");console.log("Service Worker registrado:",e),e.active&&e.active.postMessage({type:"FIREBASE_CONFIG",config:s})}return e}catch(e){return console.error("Error initializing Firebase Messaging:",e),null}}},2988:(e,t,r)=>{"use strict";r.d(t,{UV:()=>u,XM:()=>p,XT:()=>f,hH:()=>g,qM:()=>m});var n=r(8359),a=r(3090),i=r(3954);let o=null;async function s(){try{return o=await (0,a.H9)(),null!==o}catch(e){return console.error("Error checking messaging support:",e),!1}}async function l(){if(!await s())return console.warn("Firebase Messaging no est\xe1 soportado en este navegador"),!1;try{let e=await Notification.requestPermission();return"granted"===e}catch(e){return console.error("Error requesting notification permission:",e),!1}}async function c(){if(!await s()||!o)return null;if(!a.JQ)return console.error("VAPID_KEY no configurada"),null;try{return await (0,n.gf)(o,{vapidKey:a.JQ})||null}catch(e){return console.error("Error getting FCM token:",e),null}}async function d(e){try{let t=await c();if(t)return await (0,i.st)(e,t),!0;return!1}catch(e){return console.error("Error registering FCM token:",e),!1}}function u(e){return o?(0,n.xD)(o,t=>{if(console.log("Mensaje recibido en primer plano:",t),"granted"===Notification.permission){let{title:e,body:n}=t.notification||{};if(e&&n){var r;new Notification(e,{body:n,icon:"/icons/icon-192.svg",badge:"/icons/badge-72.svg",tag:(null===(r=t.data)||void 0===r?void 0:r.eventId)||"sentinel-notification"})}}e(t)}):(console.warn("Firebase Messaging no disponible para mensajes en primer plano"),()=>{})}async function p(){"granted"===Notification.permission?new Notification("\uD83D\uDD14 Sentinel - Prueba",{body:"Esta es una notificaci\xf3n de prueba de Sentinel",icon:"/icons/icon-192.svg",badge:"/icons/badge-72.svg",tag:"sentinel-test"}):console.warn("Permiso de notificaciones no concedido")}function g(){return Notification.permission}function m(){return"granted"===Notification.permission}async function f(e){return await s()?!!("default"!==Notification.permission||await l())&&"granted"===Notification.permission&&await d(e):(console.warn("Firebase Messaging no soportado"),!1)}},5502:(e,t,r)=>{"use strict";r.d(t,{As:()=>c,AuthProvider:()=>l});var n=r(5155),a=r(2115),i=r(3954),o=r(2988);let s=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("sentinel_mock_user");if(e)try{l(JSON.parse(e)),d(!1);return}catch(e){console.error("Error parsing saved mock user:",e),localStorage.removeItem("sentinel_mock_user")}return(0,i.Bh)(async e=>{if(!localStorage.getItem("sentinel_mock_user")&&(l(e),d(!1),e))try{await (0,o.XT)(e.uid)}catch(e){console.error("Error initializing notifications:",e)}})},[]);let u=async()=>{try{d(!0),await (0,i.G6)()}catch(e){throw d(!1),e}},p=async()=>{try{d(!0);let e={uid:"mock-user-123",email:"test@sentinel.app",displayName:"Usuario de Prueba",settings:{language:"es",darkMode:!0,soundEnabled:!0},createdAt:new Date,updatedAt:new Date};l(e),localStorage.setItem("sentinel_mock_user",JSON.stringify(e)),d(!1);try{await (0,o.XT)(e.uid)}catch(e){console.warn("Mock status: Notifications initialization skipped or failed in test environment")}}catch(e){throw d(!1),e}},g=async()=>{try{localStorage.removeItem("sentinel_mock_user"),await (0,i.CI)(),l(null)}catch(e){throw console.error("Error signing out:",e),e}},m=async()=>{};return(0,n.jsx)(s.Provider,{value:{user:r,loading:c,signIn:u,mockSignIn:p,logout:g,refreshUser:m},children:t})}function c(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},347:()=>{},6196:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_f367f3",variable:"__variable_f367f3"}}},e=>{var t=t=>e(e.s=t);e.O(0,[888,135,563,445,441,517,358],()=>t(9517)),_N_E=e.O()}]);