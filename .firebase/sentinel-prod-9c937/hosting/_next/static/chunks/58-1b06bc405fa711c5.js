"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58],{5812:(e,t,r)=>{r.d(t,{B:()=>c});var n=r(5155),o=r(2115),a=r(5502),i=r(6816),s=r(4450),l=r(2988);function c(){var e;let{user:t,logout:r}=(0,a.As)(),[c,d]=(0,o.useState)(!1);if(!t)return null;let u=async()=>{try{await r(),d(!1)}catch(e){console.error("Error during logout:",e)}},p=(t.displayName||t.email||"U")[0].toUpperCase();return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)(i.$,{variant:"ghost",className:"flex items-center gap-2 px-2",onClick:()=>d(!c),children:[t.photoURL?(0,n.jsx)("img",{src:t.photoURL,alt:t.displayName||"Usuario",className:"h-8 w-8 rounded-full"}):(0,n.jsx)("div",{className:"h-8 w-8 rounded-full bg-[#D4B57A] flex items-center justify-center text-[#0D0E14] text-sm font-medium",children:p}),(0,n.jsx)("span",{className:"hidden md:block text-sm text-[#E8E8F0]",children:t.displayName||(null===(e=t.email)||void 0===e?void 0:e.split("@")[0])}),(0,n.jsx)("svg",{className:"h-4 w-4 text-[#8890A0] transition-transform ".concat(c?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)}),(0,n.jsxs)(s.Zp,{className:"absolute right-0 top-full mt-2 z-50 w-56 p-0 shadow-xl",children:[(0,n.jsx)("div",{className:"p-4 border-b border-[#4A5060]/30",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[t.photoURL?(0,n.jsx)("img",{src:t.photoURL,alt:"",className:"h-10 w-10 rounded-full"}):(0,n.jsx)("div",{className:"h-10 w-10 rounded-full bg-[#D4B57A] flex items-center justify-center text-[#0D0E14] font-medium",children:p}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm text-[#E8E8F0] font-medium truncate",children:t.displayName||"Usuario"}),(0,n.jsx)("p",{className:"text-xs text-[#8890A0] truncate",children:t.email})]})]})}),(0,n.jsxs)("div",{className:"p-2",children:[(0,n.jsxs)("button",{onClick:()=>{d(!1),window.location.href="/dashboard"},className:"w-full px-3 py-2 text-sm text-left text-[#8890A0] hover:text-[#E8E8F0] hover:bg-[#1A1B22] rounded-md flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDCCA"})," Panel"]}),(0,n.jsxs)("button",{onClick:()=>{d(!1),window.location.href="/settings"},className:"w-full px-3 py-2 text-sm text-left text-[#8890A0] hover:text-[#E8E8F0] hover:bg-[#1A1B22] rounded-md flex items-center gap-2",children:[(0,n.jsx)("span",{children:"⚙️"})," Config"]}),(0,n.jsxs)("button",{onClick:async()=>{await (0,l.XM)(),d(!1)},className:"w-full px-3 py-2 text-sm text-left text-[#D4B57A] hover:bg-[#D4B57A]/10 rounded-md flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDD14"})," Probar Notificaci\xf3n"]}),(0,n.jsx)("div",{className:"border-t border-[#4A5060]/30 my-2"}),(0,n.jsxs)("button",{onClick:u,className:"w-full px-3 py-2 text-sm text-left text-[#F87171] hover:bg-[#F87171]/10 rounded-md flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDEAA"})," Salir"]})]})]})]})]})}},6816:(e,t,r)=>{r.d(t,{$:()=>i});var n=r(5155),o=r(2115),a=r(1684);let i=(0,o.forwardRef)((e,t)=>{let{className:r,variant:o="plasma",size:i="md",disabled:s,...l}=e;return(0,n.jsx)("button",{ref:t,disabled:s,className:(0,a.cn)("inline-flex items-center justify-center gap-2 rounded-lg font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",{plasma:"bg-gradient-to-r from-[#D4B57A] to-[#A8925A] text-[#0D0E14] hover:shadow-[0_0_20px_rgba(212,181,122,0.3)]",ghost:"bg-transparent text-[#8890A0] hover:bg-[#1A1B22] hover:text-[#E8E8F0]",outline:"bg-transparent border border-[#4A5060] text-[#E8E8F0] hover:border-[#7088A0] hover:bg-[#1A1B22]"}[o],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[i],r),...l})});i.displayName="Button"},4450:(e,t,r)=>{r.d(t,{BT:()=>l,Wu:()=>c,ZB:()=>s,Zp:()=>a,aR:()=>i});var n=r(5155),o=r(1684);function a(e){let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,o.cn)("bg-[#1A1B22]/85 backdrop-blur-xl border border-[#D4B57A]/10 rounded-2xl shadow-[0_8px_32px_0_rgba(0,0,0,0.37)]","transition-all duration-300 ease-out","hover:border-[#D4B57A]/30 hover:bg-[#1A1B22]/95","ring-1 ring-white/5 ring-inset",t),...r})}function i(e){let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,o.cn)("p-6 pb-2",t),...r})}function s(e){let{className:t,...r}=e;return(0,n.jsx)("h3",{className:(0,o.cn)("text-[#E8E8F0] font-semibold tracking-tight",t),...r})}function l(e){let{className:t,...r}=e;return(0,n.jsx)("p",{className:(0,o.cn)("text-[#8890A0] text-sm mt-1.5 leading-relaxed",t),...r})}function c(e){let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,o.cn)("",t),...r})}},3954:(e,t,r)=>{r.d(t,{Bh:()=>c,CI:()=>l,G6:()=>s,mJ:()=>p,st:()=>u});var n=r(5877),o=r(7058),a=r(3090);let i=new n.HF;async function s(){try{let e=(await (0,n.df)(a.j2,i)).user,t={email:e.email,displayName:e.displayName||e.email.split("@")[0],photoURL:e.photoURL||void 0,fcmToken:void 0,settings:{language:"es",darkMode:!1,soundEnabled:!0},createdAt:new Date,updatedAt:new Date};return await (0,o.setDoc)((0,o.doc)(a.db,"users",e.uid),{...t,createdAt:(0,o.serverTimestamp)(),updatedAt:(0,o.serverTimestamp)()},{merge:!0}),{uid:e.uid,...t}}catch(e){throw console.error("Error signing in with Google:",e),function(e){switch(e.code){case"auth/popup-closed-by-user":return Error("Inicio de sesi\xf3n cancelado");case"auth/popup-blocked":return Error("Popup bloqueado por el navegador");case"auth/network-request-failed":return Error("Error de conexi\xf3n");case"auth/too-many-requests":return Error("Demasiados intentos. Int\xe9ntalo m\xe1s tarde");default:return Error("Error al iniciar sesi\xf3n")}}(e)}}async function l(){try{await (0,n.CI)(a.j2)}catch(e){throw console.error("Error signing out:",e),Error("Error al cerrar sesi\xf3n")}}function c(e){return(0,n.hg)(a.j2,async t=>{if(t)try{let r=await d(t.uid);e(r)}catch(t){console.error("Error getting user data:",t),e(null)}else e(null)})}async function d(e){try{let o=await Promise.resolve().then(r.bind(r,7058)).then(t=>{let{getDoc:r,doc:n}=t;return r(n(a.db,"users",e))});if(o.exists()){var t,n;let r=o.data();return{uid:e,email:r.email,displayName:r.displayName,photoURL:r.photoURL,fcmToken:r.fcmToken,settings:r.settings||{language:"es",darkMode:!1,soundEnabled:!0},createdAt:(null===(t=r.createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(n=r.updatedAt)||void 0===n?void 0:n.toDate())||new Date}}return null}catch(e){return console.error("Error getting user data:",e),null}}async function u(e,t){try{await Promise.resolve().then(r.bind(r,7058)).then(async r=>{let{updateDoc:n,doc:o,serverTimestamp:i}=r;await n(o(a.db,"users",e),{fcmToken:t,updatedAt:i()})})}catch(e){console.error("Error updating FCM token:",e)}}async function p(e,t){try{await Promise.resolve().then(r.bind(r,7058)).then(async r=>{let{updateDoc:n,doc:o,serverTimestamp:i}=r;await n(o(a.db,"users",e),{settings:t,updatedAt:i()})})}catch(e){throw console.error("Error updating user settings:",e),Error("Error al actualizar configuraci\xf3n")}}i.setCustomParameters({prompt:"select_account"})},3090:(e,t,r)=>{r.d(t,{H9:()=>p,JQ:()=>u,db:()=>d,j2:()=>c});var n=r(9904),o=r(5877),a=r(7058),i=r(8359);let s={apiKey:"AIzaSyDp2z1FBMgNWJeAhOuOXgrglx9yFf_ras8",authDomain:"sentinel-prod-9c937.firebaseapp.com",projectId:"sentinel-prod-9c937",storageBucket:"sentinel-prod-9c937.firebasestorage.app",messagingSenderId:"846642937822",appId:"1:846642937822:web:b0db6f6c5f3db4c3d3274f"};if(!s.apiKey||!s.projectId)throw console.error("Firebase config incomplete:",{hasApiKey:!!s.apiKey,hasProjectId:!!s.projectId,hasAuthDomain:!!s.authDomain}),Error("Firebase configuration is incomplete. Check environment variables.");let l=0===(0,n.Dk)().length?(0,n.Wp)(s):(0,n.Dk)()[0],c=(0,o.xI)(l),d=(0,a.getFirestore)(l);console.log("Firebase initialized:",{projectId:s.projectId,hasAuth:!!c,hasDb:!!d});let u="BHOX3qNmiQt7WlXM0ZxYlWlmiAIgK-bJxzfexJ6rRQYwPjNnrc-XMxIvkwyakuJ2hLGiCSl8KM-mueYni4fL9zc";async function p(){try{if(!await (0,i.TT)())return console.warn("Firebase Messaging no est\xe1 soportado en este navegador"),null;let e=(0,i.dG)(l);if("serviceWorker"in navigator){let e=await navigator.serviceWorker.register("/firebase-messaging-sw.js");console.log("Service Worker registrado:",e),e.active&&e.active.postMessage({type:"FIREBASE_CONFIG",config:s})}return e}catch(e){return console.error("Error initializing Firebase Messaging:",e),null}}},3401:(e,t,r)=>{r.d(t,{HT:()=>c,PH:()=>d,Ss:()=>p,Z8:()=>i,ZV:()=>u,bA:()=>m,d9:()=>s,kQ:()=>a,lT:()=>l});var n=r(7058),o=r(3090);async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{disasterTypes:[],minSeverity:1};try{let t=[];e.disasterTypes&&e.disasterTypes.length>0&&t.push((0,n.where)("disasterType","in",e.disasterTypes)),e.minSeverity&&e.minSeverity>1&&t.push((0,n.where)("severity",">=",e.minSeverity)),t.push((0,n.orderBy)("eventTime","desc")),t.push((0,n.limit)(100));let r=(0,n.query)((0,n.collection)(o.db,"events"),...t);return(await (0,n.getDocs)(r)).docs.map(e=>{var t,r,n;let o=e.data(),a=o.location,i=null!==(r=null==a?void 0:a.latitude)&&void 0!==r?r:null==a?void 0:a.lat,s=null!==(n=null==a?void 0:a.longitude)&&void 0!==n?n:null==a?void 0:a.lng;return{id:e.id,...o,location:{lat:i,lng:s},eventTime:o.eventTime.toDate(),expiresAt:null===(t=o.expiresAt)||void 0===t?void 0:t.toDate(),createdAt:o.createdAt.toDate(),updatedAt:o.updatedAt.toDate()}})}catch(e){throw console.error("Error getting events:",e),Error("Error al obtener eventos")}}async function i(e){try{let i=(0,n.doc)(o.db,"events",e),s=await (0,n.getDoc)(i);if(s.exists()){var t,r,a;let e=s.data(),n=e.location,o=null!==(r=null==n?void 0:n.latitude)&&void 0!==r?r:null==n?void 0:n.lat,i=null!==(a=null==n?void 0:n.longitude)&&void 0!==a?a:null==n?void 0:n.lng;return{id:s.id,...e,location:{lat:o,lng:i},eventTime:e.eventTime.toDate(),expiresAt:null===(t=e.expiresAt)||void 0===t?void 0:t.toDate(),createdAt:e.createdAt.toDate(),updatedAt:e.updatedAt.toDate()}}return null}catch(e){return console.error("Error getting event:",e),null}}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{disasterTypes:[],minSeverity:1},r=[];t.disasterTypes&&t.disasterTypes.length>0&&r.push((0,n.where)("disasterType","in",t.disasterTypes)),t.minSeverity&&t.minSeverity>1&&r.push((0,n.where)("severity",">=",t.minSeverity)),r.push((0,n.orderBy)("eventTime","desc")),r.push((0,n.limit)(50));let a=(0,n.query)((0,n.collection)(o.db,"events"),...r);return(0,n.onSnapshot)(a,t=>{e(t.docs.map(e=>{var t,r,n;let o=e.data(),a=o.location,i=null!==(r=null==a?void 0:a.latitude)&&void 0!==r?r:null==a?void 0:a.lat,s=null!==(n=null==a?void 0:a.longitude)&&void 0!==n?n:null==a?void 0:a.lng;return{id:e.id,...o,location:{lat:i,lng:s},eventTime:o.eventTime.toDate(),expiresAt:null===(t=o.expiresAt)||void 0===t?void 0:t.toDate(),createdAt:o.createdAt.toDate(),updatedAt:o.updatedAt.toDate()}}))},e=>{console.error("Error subscribing to events:",e)})}async function l(e){try{let t=(0,n.query)((0,n.collection)(o.db,"users",e,"zones"),(0,n.orderBy)("createdAt","desc"));return(await (0,n.getDocs)(t)).docs.map(t=>{let r=t.data();return{id:t.id,userId:e,...r,location:{lat:r.location.latitude,lng:r.location.longitude},createdAt:r.createdAt.toDate()}})}catch(e){throw console.error("Error getting user zones:",e),Error("Error al obtener zonas")}}async function c(e,t){try{return(await (0,n.addDoc)((0,n.collection)(o.db,"users",e,"zones"),{...t,location:new n.GeoPoint(t.location.lat,t.location.lng),createdAt:n.Timestamp.now()})).id}catch(e){throw console.error("Error adding zone:",e),Error("Error al agregar zona")}}async function d(e,t,r){try{let a={...r};r.location&&(a.location=new n.GeoPoint(r.location.lat,r.location.lng)),await (0,n.updateDoc)((0,n.doc)(o.db,"users",e,"zones",t),a)}catch(e){throw console.error("Error updating zone:",e),Error("Error al actualizar zona")}}async function u(e,t){try{await (0,n.deleteDoc)((0,n.doc)(o.db,"users",e,"zones",t))}catch(e){throw console.error("Error deleting zone:",e),Error("Error al eliminar zona")}}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let r=(0,n.query)((0,n.collection)(o.db,"notifications"),(0,n.where)("userId","==",e),(0,n.orderBy)("sentAt","desc"),(0,n.limit)(t));return(await (0,n.getDocs)(r)).docs.map(e=>{var t;let r=e.data();return{id:e.id,...r,sentAt:r.sentAt.toDate(),readAt:null===(t=r.readAt)||void 0===t?void 0:t.toDate()}})}catch(e){return console.error("Error getting notifications:",e),[]}}async function m(e){try{await (0,n.updateDoc)((0,n.doc)(o.db,"notifications",e),{readAt:n.Timestamp.now()})}catch(e){console.error("Error marking notification as read:",e)}}},2988:(e,t,r)=>{r.d(t,{UV:()=>u,XM:()=>p,XT:()=>h,hH:()=>m,qM:()=>g});var n=r(8359),o=r(3090),a=r(3954);let i=null;async function s(){try{return i=await (0,o.H9)(),null!==i}catch(e){return console.error("Error checking messaging support:",e),!1}}async function l(){if(!await s())return console.warn("Firebase Messaging no est\xe1 soportado en este navegador"),!1;try{let e=await Notification.requestPermission();return"granted"===e}catch(e){return console.error("Error requesting notification permission:",e),!1}}async function c(){if(!await s()||!i)return null;if(!o.JQ)return console.error("VAPID_KEY no configurada"),null;try{return await (0,n.gf)(i,{vapidKey:o.JQ})||null}catch(e){return console.error("Error getting FCM token:",e),null}}async function d(e){try{let t=await c();if(t)return await (0,a.st)(e,t),!0;return!1}catch(e){return console.error("Error registering FCM token:",e),!1}}function u(e){return i?(0,n.xD)(i,t=>{if(console.log("Mensaje recibido en primer plano:",t),"granted"===Notification.permission){let{title:e,body:n}=t.notification||{};if(e&&n){var r;new Notification(e,{body:n,icon:"/icons/icon-192.svg",badge:"/icons/badge-72.svg",tag:(null===(r=t.data)||void 0===r?void 0:r.eventId)||"sentinel-notification"})}}e(t)}):(console.warn("Firebase Messaging no disponible para mensajes en primer plano"),()=>{})}async function p(){"granted"===Notification.permission?new Notification("\uD83D\uDD14 Sentinel - Prueba",{body:"Esta es una notificaci\xf3n de prueba de Sentinel",icon:"/icons/icon-192.svg",badge:"/icons/badge-72.svg",tag:"sentinel-test"}):console.warn("Permiso de notificaciones no concedido")}function m(){return Notification.permission}function g(){return"granted"===Notification.permission}async function h(e){return await s()?!!("default"!==Notification.permission||await l())&&"granted"===Notification.permission&&await d(e):(console.warn("Firebase Messaging no soportado"),!1)}},5502:(e,t,r)=>{r.d(t,{As:()=>c,AuthProvider:()=>l});var n=r(5155),o=r(2115),a=r(3954),i=r(2988);let s=(0,o.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("sentinel_mock_user");if(e)try{l(JSON.parse(e)),d(!1);return}catch(e){console.error("Error parsing saved mock user:",e),localStorage.removeItem("sentinel_mock_user")}return(0,a.Bh)(async e=>{if(!localStorage.getItem("sentinel_mock_user")&&(l(e),d(!1),e))try{await (0,i.XT)(e.uid)}catch(e){console.error("Error initializing notifications:",e)}})},[]);let u=async()=>{try{d(!0),await (0,a.G6)()}catch(e){throw d(!1),e}},p=async()=>{try{d(!0);let e={uid:"mock-user-123",email:"test@sentinel.app",displayName:"Usuario de Prueba",settings:{language:"es",darkMode:!0,soundEnabled:!0},createdAt:new Date,updatedAt:new Date};l(e),localStorage.setItem("sentinel_mock_user",JSON.stringify(e)),d(!1);try{await (0,i.XT)(e.uid)}catch(e){console.warn("Mock status: Notifications initialization skipped or failed in test environment")}}catch(e){throw d(!1),e}},m=async()=>{try{localStorage.removeItem("sentinel_mock_user"),await (0,a.CI)(),l(null)}catch(e){throw console.error("Error signing out:",e),e}},g=async()=>{};return(0,n.jsx)(s.Provider,{value:{user:r,loading:c,signIn:u,mockSignIn:p,logout:m,refreshUser:g},children:t})}function c(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1684:(e,t,r)=>{r.d(t,{cn:()=>a});var n=r(3463),o=r(9795);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,n.$)(t))}}}]);