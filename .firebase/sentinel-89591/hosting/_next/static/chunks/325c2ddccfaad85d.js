(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},3374,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(22016),s=e.i(57688),i=e.i(18566),n=e.i(54579),l=e.i(13741),c=e.i(52366);function o(){let{user:e}=(0,n.useAuth)(),o=(0,i.usePathname)(),[d,u]=(0,r.useState)(!1),h=[{href:"/",label:"Mapa",requiresAuth:!1},{href:"/dashboard",label:"Panel",requiresAuth:!0},{href:"/settings",label:"Config",requiresAuth:!0}].filter(t=>!t.requiresAuth||e);return(0,t.jsxs)("header",{className:"sticky top-0 z-50 w-full border-b border-[#4A5060]/30 bg-[#0D0E14]/90 backdrop-blur-md",children:[(0,t.jsxs)("div",{className:"max-w-6xl mx-auto flex h-16 items-center justify-between px-4",children:[(0,t.jsxs)(a.default,{href:"/",className:"flex items-center gap-2 group",children:[(0,t.jsx)("div",{className:"relative w-9 h-9 transition-transform group-hover:scale-105",children:(0,t.jsx)(s.default,{src:"/logo.svg",alt:"Sentinel Logo",fill:!0,className:"object-contain drop-shadow-[0_0_10px_rgba(212,181,122,0.3)]"})}),(0,t.jsx)("span",{className:"font-semibold text-[#D4B57A] tracking-wider hidden sm:block",children:"SENTINEL"})]}),(0,t.jsx)("nav",{className:"hidden md:flex items-center gap-1",children:h.map(e=>(0,t.jsx)(a.default,{href:e.href,className:`px-3 py-1.5 rounded-md text-sm transition-colors ${o===e.href?"bg-[#D4B57A]/10 text-[#D4B57A]":"text-[#8890A0] hover:text-[#E8E8F0] hover:bg-[#1A1B22]"}`,children:e.label},e.href))}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[e?(0,t.jsx)(c.UserMenu,{}):(0,t.jsx)(l.LoginButton,{}),(0,t.jsx)("button",{onClick:()=>u(!d),className:"md:hidden p-2 text-[#8890A0] hover:text-[#E8E8F0]","aria-label":"Menu",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d?(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),d&&(0,t.jsx)("nav",{className:"md:hidden border-t border-[#4A5060]/30 bg-[#0D0E14] p-4 space-y-1",children:h.map(e=>(0,t.jsx)(a.default,{href:e.href,onClick:()=>u(!1),className:`block px-3 py-2 rounded-md text-sm ${o===e.href?"bg-[#D4B57A]/10 text-[#D4B57A]":"text-[#8890A0] hover:text-[#E8E8F0]"}`,children:e.label},e.href))})]})}e.s(["Header",()=>o])},58594,e=>{"use strict";var t=e.i(43476);function r({size:e="md",className:r=""}){return(0,t.jsx)("div",{className:`${{sm:"w-4 h-4 border-2",md:"w-6 h-6 border-2",lg:"w-8 h-8 border-3"}[e]} border-[#D4B57A] border-t-transparent rounded-full animate-spin ${r}`})}function a({text:e}){return(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3 py-8",children:[(0,t.jsx)(r,{size:"lg"}),e&&(0,t.jsx)("p",{className:"text-[#8890A0] text-sm",children:e})]})}e.s(["LoadingSpinner",()=>a])},58709,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(54579),i=e.i(58594);function n({children:e,redirectTo:n="/login",requireAuth:l=!0}){let{user:c,loading:o}=(0,s.useAuth)(),d=(0,a.useRouter)();return((0,r.useEffect)(()=>{o||(l&&!c?d.push(n):!l&&c&&d.push("/"))},[c,o,l,n,d]),o)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(i.LoadingSpinner,{text:"Verificando sesi贸n..."})}):l&&!c||!l&&c?null:(0,t.jsx)(t.Fragment,{children:e})}e.s(["AuthGuard",()=>n])},96640,e=>{"use strict";var t=e.i(43476),r=e.i(91285);function a({className:e,variant:a="plasma",...s}){return(0,t.jsx)("span",{className:(0,r.cn)("inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border",{plasma:"bg-[#D4B57A]/15 text-[#D4B57A] border-[#D4B57A]/30",mist:"bg-[#7088A0]/15 text-[#7088A0] border-[#7088A0]/30",success:"bg-[#4ADE80]/15 text-[#4ADE80] border-[#4ADE80]/30",warning:"bg-[#FBBF24]/15 text-[#FBBF24] border-[#FBBF24]/30",danger:"bg-[#F87171]/15 text-[#F87171] border-[#F87171]/30",secondary:"bg-[#4A5060]/30 text-[#8890A0] border-[#4A5060]/40"}[a],e),...s})}e.s(["Badge",()=>a])},39313,e=>{"use strict";var t=e.i(71645),r=e.i(54579),a=e.i(28623);function s(){let{user:e}=(0,r.useAuth)(),[s,i]=(0,t.useState)([]),[n,l]=(0,t.useState)(!1),[c,o]=(0,t.useState)(null),d=e?.uid,u=(0,t.useCallback)(async()=>{if(!d)return void i([]);try{l(!0),o(null);let e=await (0,a.getUserZones)(d);i(e)}catch(e){console.error("Error loading zones:",e),o("Error al cargar zonas")}finally{l(!1)}},[d]);(0,t.useEffect)(()=>{u()},[u]);let h=(0,t.useCallback)(async e=>{if(!d)throw Error("Usuario no autenticado");try{o(null);let t=await (0,a.addUserZone)(d,e);return await u(),t}catch(e){throw console.error("Error creating zone:",e),o("Error al crear zona"),e}},[d,u]),x=(0,t.useCallback)(async(e,t)=>{if(!d)throw Error("Usuario no autenticado");try{o(null),await (0,a.updateUserZone)(d,e,t),await u()}catch(e){throw console.error("Error updating zone:",e),o("Error al actualizar zona"),e}},[d,u]),m=(0,t.useCallback)(async e=>{if(!d)throw Error("Usuario no autenticado");try{o(null),await (0,a.deleteUserZone)(d,e),await u()}catch(e){throw console.error("Error deleting zone:",e),o("Error al eliminar zona"),e}},[d,u]),f=(0,t.useCallback)(async(e,t)=>x(e,{isActive:t}),[x]),g=s.filter(e=>e.isActive),j=(0,t.useCallback)((e,t,r=0)=>g.some(a=>{var s,i,n,l;let c,o,d;return s=e,i=t,n=a.location.lat,l=a.location.lng,2*Math.atan2(Math.sqrt(d=Math.sin((c=(s-n)*Math.PI/180)/2)*Math.sin(c/2)+Math.cos(n*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin((o=(i-l)*Math.PI/180)/2)*Math.sin(o/2)),Math.sqrt(1-d))*6371<=a.radiusKm+r}),[g]);return{zones:s,activeZones:g,loading:n,error:c,createZone:h,updateZone:x,removeZone:m,toggleZone:f,refresh:u,isLocationInUserZones:j}}e.s(["useUserZones",()=>s])},30257,e=>{"use strict";var t=e.i(43476),r=e.i(58709),a=e.i(3374),s=e.i(39964),i=e.i(59544),n=e.i(39313),l=e.i(71645),c=e.i(54579),o=e.i(28623),d=e.i(68082),u=e.i(96640);e.i(36180);var h=e.i(98925);function x(){let{enabled:e,permission:r}=function(){let{user:e}=(0,c.useAuth)(),[t,r]=(0,l.useState)("default"),[a,s]=(0,l.useState)(!1),[i,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{r((0,d.getNotificationPermission)()),s((0,d.areNotificationsEnabled)())},[]),{permission:t,enabled:a,loading:i,initialize:(0,l.useCallback)(async()=>{if(!e?.uid)return!1;try{n(!0);let t=await (0,d.initializeNotifications)(e.uid);return s(t),r((0,d.getNotificationPermission)()),t}catch(e){return console.error("Error initializing notifications:",e),!1}finally{n(!1)}},[e?.uid]),testNotification:(0,l.useCallback)(async()=>{try{await (0,d.showTestNotification)()}catch(e){console.error("Error showing test notification:",e)}},[]),canRequestPermission:"default"===t,isGranted:"granted"===t,isDenied:"denied"===t}}(),[a,i]=(0,l.useState)("checking"),[n,o]=(0,l.useState)(null);return(0,l.useEffect)(()=>{async function e(){try{i("checking");let e=(0,h.getFirestore)(),t=(0,h.query)((0,h.collection)(e,"events"),(0,h.limit)(1));await (0,h.getDocs)(t),i("active"),o(new Date)}catch(e){console.error("System health check failed:",e),i("inactive")}}e();let t=setInterval(e,3e5);return()=>clearInterval(t)},[]),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{className:"flex items-center gap-2",children:"锔 Estado del Sistema"}),(0,t.jsx)(s.CardDescription,{children:"Informaci贸n del servicio"})]}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm",children:"Conexi贸n API"}),(e=>{switch(e){case"active":return(0,t.jsx)(u.Badge,{variant:"success",children:"Activo"});case"inactive":return(0,t.jsx)(u.Badge,{variant:"danger",children:"Error"});case"checking":return(0,t.jsx)(u.Badge,{variant:"secondary",children:"..."})}})(a)]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm",children:"Notificaciones Push"}),e?(0,t.jsx)(u.Badge,{variant:"success",children:"Activadas"}):"denied"===r?(0,t.jsx)(u.Badge,{variant:"danger",children:"Bloqueadas"}):(0,t.jsx)(u.Badge,{variant:"secondary",children:"Inactivas"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm",children:"ltima comprobaci贸n"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:n?n.toLocaleTimeString():"-"})]})]})})]})}var m=e.i(18566);function f(){let{zones:e,loading:u}=(0,n.useUserZones)(),{notifications:h,loading:f}=function(e=24){let{notifications:t,loading:r,error:a}=function(){let{user:e}=(0,c.useAuth)(),[t,r]=(0,l.useState)([]),[a,s]=(0,l.useState)(!1),[i,n]=(0,l.useState)(null),[u,h]=(0,l.useState)(0),x=e?.uid,m=(0,l.useCallback)(async()=>{if(!x){r([]),h(0);return}try{s(!0),n(null);let e=await (0,o.getUserNotifications)(x);r(e),h(e.filter(e=>!e.readAt).length)}catch(e){console.error("Error loading notifications:",e),n("Error al cargar notificaciones")}finally{s(!1)}},[x]);(0,l.useEffect)(()=>{m()},[m]),(0,l.useEffect)(()=>{if(x)return(0,d.onForegroundMessage)(e=>{m(),console.log("Nueva notificaci贸n recibida:",e)})},[x,m]);let f=(0,l.useCallback)(async e=>{try{await (0,o.markNotificationAsRead)(e),r(t=>t.map(t=>t.id===e?{...t,readAt:new Date}:t)),h(e=>Math.max(0,e-1))}catch(e){console.error("Error marking notification as read:",e),n("Error al marcar notificaci贸n como le铆da")}},[]),g=(0,l.useCallback)(async()=>{let e=t.filter(e=>!e.readAt);try{await Promise.all(e.map(e=>(0,o.markNotificationAsRead)(e.id))),h(0)}catch(e){console.error("Error marking all notifications as read:",e),n("Error al marcar todas las notificaciones como le铆das")}},[t,o.markNotificationAsRead]);return{notifications:t,loading:a,error:i,unreadCount:u,markAsRead:f,markAllAsRead:g,refresh:m}}(),s=new Date(Date.now()-60*e*6e4);return{notifications:t.filter(e=>e.sentAt>=s),loading:r,error:a}}(168),g=(0,m.useRouter)();return(0,t.jsx)(r.AuthGuard,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(a.Header,{}),(0,t.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Panel de Control"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Gestiona tus zonas de monitoreo y preferencias de alertas"})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{className:"flex items-center gap-2",children:" Mis Zonas"}),(0,t.jsx)(s.CardDescription,{children:"Zonas configuradas para monitoreo"})]}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-3xl font-bold mb-2",children:u?"...":e.length}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:0===e.length?"No tienes zonas configuradas":`${e.length} zonas activas`}),(0,t.jsx)(i.Button,{className:"mt-4",size:"sm",onClick:()=>g.push("/settings"),children:"Agregar Zona"})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{className:"flex items-center gap-2",children:" Alertas Recientes"}),(0,t.jsx)(s.CardDescription,{children:"Notificaciones de los 煤ltimos 7 d铆as"})]}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-3xl font-bold mb-2",children:f?"...":h.length}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:0===h.length?"Sin alertas recientes":"Alertas recibidas"}),h.length>0&&(0,t.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto custom-scrollbar",children:h.slice(0,3).map(e=>(0,t.jsxs)("div",{className:"flex flex-col text-sm border-b border-white/5 pb-2 last:border-0",children:[(0,t.jsx)("span",{className:"font-medium text-xs",children:e.event?.title||"Evento"}),(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:new Date(e.sentAt).toLocaleDateString()})]},e.id))})]})]}),(0,t.jsx)(x,{})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{children:"Acciones R谩pidas"}),(0,t.jsx)(s.CardDescription,{children:"Configura tu experiencia de monitoreo"})]}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)(i.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/settings"),children:[(0,t.jsx)("span",{className:"text-2xl",children:""}),(0,t.jsx)("span",{children:"Administrar Zonas"})]}),(0,t.jsxs)(i.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/settings"),children:[(0,t.jsx)("span",{className:"text-2xl",children:""}),(0,t.jsx)("span",{children:"Preferencias de Alertas"})]}),(0,t.jsxs)(i.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/"),children:[(0,t.jsx)("span",{className:"text-2xl",children:""}),(0,t.jsx)("span",{children:"Ver Mapa en Vivo"})]}),(0,t.jsxs)(i.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/settings"),children:[(0,t.jsx)("span",{className:"text-2xl",children:"锔"}),(0,t.jsx)("span",{children:"Configuraci贸n General"})]})]})})]})]})]})})}e.s(["default",()=>f],30257)}]);