(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,s,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},30257,e=>{"use strict";var s=e.i(43476),a=e.i(58709),t=e.i(3374),i=e.i(39964),r=e.i(59544),n=e.i(39313),c=e.i(71645),l=e.i(54579),o=e.i(28623),d=e.i(68082),u=e.i(96640);e.i(36180);var x=e.i(98925);function h(){let{enabled:e,permission:a}=function(){let{user:e}=(0,l.useAuth)(),[s,a]=(0,c.useState)("default"),[t,i]=(0,c.useState)(!1),[r,n]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{a((0,d.getNotificationPermission)()),i((0,d.areNotificationsEnabled)())},[]),{permission:s,enabled:t,loading:r,initialize:(0,c.useCallback)(async()=>{if(!e?.uid)return!1;try{n(!0);let s=await (0,d.initializeNotifications)(e.uid);return i(s),a((0,d.getNotificationPermission)()),s}catch(e){return console.error("Error initializing notifications:",e),!1}finally{n(!1)}},[e?.uid]),testNotification:(0,c.useCallback)(async()=>{try{await (0,d.showTestNotification)()}catch(e){console.error("Error showing test notification:",e)}},[]),canRequestPermission:"default"===s,isGranted:"granted"===s,isDenied:"denied"===s}}(),[t,r]=(0,c.useState)("checking"),[n,o]=(0,c.useState)(null);return(0,c.useEffect)(()=>{async function e(){try{r("checking");let e=(0,x.getFirestore)(),s=(0,x.query)((0,x.collection)(e,"events"),(0,x.limit)(1));await (0,x.getDocs)(s),r("active"),o(new Date)}catch(e){console.error("System health check failed:",e),r("inactive")}}e();let s=setInterval(e,3e5);return()=>clearInterval(s)},[]),(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{className:"flex items-center gap-2",children:"锔 Estado del Sistema"}),(0,s.jsx)(i.CardDescription,{children:"Informaci贸n del servicio"})]}),(0,s.jsx)(i.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm",children:"Conexi贸n API"}),(e=>{switch(e){case"active":return(0,s.jsx)(u.Badge,{variant:"success",children:"Activo"});case"inactive":return(0,s.jsx)(u.Badge,{variant:"danger",children:"Error"});case"checking":return(0,s.jsx)(u.Badge,{variant:"secondary",children:"..."})}})(t)]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm",children:"Notificaciones Push"}),e?(0,s.jsx)(u.Badge,{variant:"success",children:"Activadas"}):"denied"===a?(0,s.jsx)(u.Badge,{variant:"danger",children:"Bloqueadas"}):(0,s.jsx)(u.Badge,{variant:"secondary",children:"Inactivas"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm",children:"ltima comprobaci贸n"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:n?n.toLocaleTimeString():"-"})]})]})})]})}var m=e.i(18566);function f(){let{zones:e,loading:u}=(0,n.useUserZones)(),{notifications:x,loading:f}=function(e=24){let{notifications:s,loading:a,error:t}=function(){let{user:e}=(0,l.useAuth)(),[s,a]=(0,c.useState)([]),[t,i]=(0,c.useState)(!1),[r,n]=(0,c.useState)(null),[u,x]=(0,c.useState)(0),h=e?.uid,m=(0,c.useCallback)(async()=>{if(!h){a([]),x(0);return}try{i(!0),n(null);let e=await (0,o.getUserNotifications)(h);a(e),x(e.filter(e=>!e.readAt).length)}catch(e){console.error("Error loading notifications:",e),n("Error al cargar notificaciones")}finally{i(!1)}},[h]);(0,c.useEffect)(()=>{m()},[m]),(0,c.useEffect)(()=>{if(h)return(0,d.onForegroundMessage)(e=>{m(),console.log("Nueva notificaci贸n recibida:",e)})},[h,m]);let f=(0,c.useCallback)(async e=>{try{await (0,o.markNotificationAsRead)(e),a(s=>s.map(s=>s.id===e?{...s,readAt:new Date}:s)),x(e=>Math.max(0,e-1))}catch(e){console.error("Error marking notification as read:",e),n("Error al marcar notificaci贸n como le铆da")}},[]),g=(0,c.useCallback)(async()=>{let e=s.filter(e=>!e.readAt);try{await Promise.all(e.map(e=>(0,o.markNotificationAsRead)(e.id))),x(0)}catch(e){console.error("Error marking all notifications as read:",e),n("Error al marcar todas las notificaciones como le铆das")}},[s,o.markNotificationAsRead]);return{notifications:s,loading:t,error:r,unreadCount:u,markAsRead:f,markAllAsRead:g,refresh:m}}(),i=new Date(Date.now()-60*e*6e4);return{notifications:s.filter(e=>e.sentAt>=i),loading:a,error:t}}(168),g=(0,m.useRouter)();return(0,s.jsx)(a.AuthGuard,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,s.jsx)(t.Header,{}),(0,s.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Panel de Control"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Gestiona tus zonas de monitoreo y preferencias de alertas"})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{className:"flex items-center gap-2",children:" Mis Zonas"}),(0,s.jsx)(i.CardDescription,{children:"Zonas configuradas para monitoreo"})]}),(0,s.jsxs)(i.CardContent,{children:[(0,s.jsx)("div",{className:"text-3xl font-bold mb-2",children:u?"...":e.length}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:0===e.length?"No tienes zonas configuradas":`${e.length} zonas activas`}),(0,s.jsx)(r.Button,{className:"mt-4",size:"sm",onClick:()=>g.push("/settings"),children:"Agregar Zona"})]})]}),(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{className:"flex items-center gap-2",children:" Alertas Recientes"}),(0,s.jsx)(i.CardDescription,{children:"Notificaciones de los 煤ltimos 7 d铆as"})]}),(0,s.jsxs)(i.CardContent,{children:[(0,s.jsx)("div",{className:"text-3xl font-bold mb-2",children:f?"...":x.length}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:0===x.length?"Sin alertas recientes":"Alertas recibidas"}),x.length>0&&(0,s.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto custom-scrollbar",children:x.slice(0,3).map(e=>(0,s.jsxs)("div",{className:"flex flex-col text-sm border-b border-white/5 pb-2 last:border-0",children:[(0,s.jsx)("span",{className:"font-medium text-xs",children:e.event?.title||"Evento"}),(0,s.jsx)("span",{className:"text-[10px] text-muted-foreground",children:new Date(e.sentAt).toLocaleDateString()})]},e.id))})]})]}),(0,s.jsx)(h,{})]}),(0,s.jsxs)(i.Card,{children:[(0,s.jsxs)(i.CardHeader,{children:[(0,s.jsx)(i.CardTitle,{children:"Acciones R谩pidas"}),(0,s.jsx)(i.CardDescription,{children:"Configura tu experiencia de monitoreo"})]}),(0,s.jsx)(i.CardContent,{children:(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)(r.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/settings"),children:[(0,s.jsx)("span",{className:"text-2xl",children:""}),(0,s.jsx)("span",{children:"Administrar Zonas"})]}),(0,s.jsxs)(r.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/settings"),children:[(0,s.jsx)("span",{className:"text-2xl",children:""}),(0,s.jsx)("span",{children:"Preferencias de Alertas"})]}),(0,s.jsxs)(r.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/"),children:[(0,s.jsx)("span",{className:"text-2xl",children:""}),(0,s.jsx)("span",{children:"Ver Mapa en Vivo"})]}),(0,s.jsxs)(r.Button,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>g.push("/settings"),children:[(0,s.jsx)("span",{className:"text-2xl",children:"锔"}),(0,s.jsx)("span",{children:"Configuraci贸n General"})]})]})})]})]})]})})}e.s(["default",()=>f],30257)}]);