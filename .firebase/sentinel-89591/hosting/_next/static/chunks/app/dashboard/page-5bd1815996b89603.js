(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{119:(e,s,t)=>{Promise.resolve().then(t.bind(t,3548))},6046:(e,s,t)=>{"use strict";var r=t(6658);t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},3548:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>j});var r=t(5155),a=t(7641),n=t(7167),i=t(4450),l=t(6816),c=t(4232),o=t(2115),d=t(5502),u=t(3401),h=t(2988),x=t(5633),m=t(7058);function f(){let{enabled:e,permission:s}=function(){let{user:e}=(0,d.As)(),[s,t]=(0,o.useState)("default"),[r,a]=(0,o.useState)(!1),[n,i]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{t((0,h.hH)()),a((0,h.qM)())},[]),{permission:s,enabled:r,loading:n,initialize:(0,o.useCallback)(async()=>{if(!(null==e?void 0:e.uid))return!1;try{i(!0);let s=await (0,h.XT)(e.uid);return a(s),t((0,h.hH)()),s}catch(e){return console.error("Error initializing notifications:",e),!1}finally{i(!1)}},[null==e?void 0:e.uid]),testNotification:(0,o.useCallback)(async()=>{try{await (0,h.XM)()}catch(e){console.error("Error showing test notification:",e)}},[]),canRequestPermission:"default"===s,isGranted:"granted"===s,isDenied:"denied"===s}}(),[t,a]=(0,o.useState)("checking"),[n,l]=(0,o.useState)(null);return(0,o.useEffect)(()=>{async function e(){try{a("checking");let e=(0,m.getFirestore)(),s=(0,m.query)((0,m.collection)(e,"events"),(0,m.limit)(1));await (0,m.getDocs)(s),a("active"),l(new Date)}catch(e){console.error("System health check failed:",e),a("inactive")}}e();let s=setInterval(e,3e5);return()=>clearInterval(s)},[]),(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{className:"flex items-center gap-2",children:"⚙️ Estado del Sistema"}),(0,r.jsx)(i.BT,{children:"Informaci\xf3n del servicio"})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm",children:"Conexi\xf3n API"}),(e=>{switch(e){case"active":return(0,r.jsx)(x.E,{variant:"success",children:"Activo"});case"inactive":return(0,r.jsx)(x.E,{variant:"danger",children:"Error"});case"checking":return(0,r.jsx)(x.E,{variant:"secondary",children:"..."})}})(t)]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm",children:"Notificaciones Push"}),e?(0,r.jsx)(x.E,{variant:"success",children:"Activadas"}):"denied"===s?(0,r.jsx)(x.E,{variant:"danger",children:"Bloqueadas"}):(0,r.jsx)(x.E,{variant:"secondary",children:"Inactivas"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm",children:"\xdaltima comprobaci\xf3n"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:n?n.toLocaleTimeString():"-"})]})]})})]})}var p=t(6046);function j(){let{zones:e,loading:s}=(0,c.o)(),{notifications:t,loading:x}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,{notifications:s,loading:t,error:r}=function(){let{user:e}=(0,d.As)(),[s,t]=(0,o.useState)([]),[r,a]=(0,o.useState)(!1),[n,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(0),x=null==e?void 0:e.uid,m=(0,o.useCallback)(async()=>{if(!x){t([]),c(0);return}try{a(!0),i(null);let e=await (0,u.Ss)(x);t(e),c(e.filter(e=>!e.readAt).length)}catch(e){console.error("Error loading notifications:",e),i("Error al cargar notificaciones")}finally{a(!1)}},[x]);(0,o.useEffect)(()=>{m()},[m]),(0,o.useEffect)(()=>{if(x)return(0,h.UV)(e=>{m(),console.log("Nueva notificaci\xf3n recibida:",e)})},[x,m]);let f=(0,o.useCallback)(async e=>{try{await (0,u.bA)(e),t(s=>s.map(s=>s.id===e?{...s,readAt:new Date}:s)),c(e=>Math.max(0,e-1))}catch(e){console.error("Error marking notification as read:",e),i("Error al marcar notificaci\xf3n como le\xedda")}},[]),p=(0,o.useCallback)(async()=>{let e=s.filter(e=>!e.readAt);try{await Promise.all(e.map(e=>(0,u.bA)(e.id))),c(0)}catch(e){console.error("Error marking all notifications as read:",e),i("Error al marcar todas las notificaciones como le\xeddas")}},[s,u.bA]);return{notifications:s,loading:r,error:n,unreadCount:l,markAsRead:f,markAllAsRead:p,refresh:m}}(),a=new Date(Date.now()-36e5*e);return{notifications:s.filter(e=>e.sentAt>=a),loading:t,error:r}}(168),m=(0,p.useRouter)();return(0,r.jsx)(a.AuthGuard,{children:(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)(n.Header,{}),(0,r.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Panel de Control"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Gestiona tus zonas de monitoreo y preferencias de alertas"})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{className:"flex items-center gap-2",children:"\uD83D\uDCCD Mis Zonas"}),(0,r.jsx)(i.BT,{children:"Zonas configuradas para monitoreo"})]}),(0,r.jsxs)(i.Wu,{children:[(0,r.jsx)("div",{className:"text-3xl font-bold mb-2",children:s?"...":e.length}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:0===e.length?"No tienes zonas configuradas":"".concat(e.length," zonas activas")}),(0,r.jsx)(l.$,{className:"mt-4",size:"sm",onClick:()=>m.push("/settings"),children:"Agregar Zona"})]})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{className:"flex items-center gap-2",children:"\uD83D\uDD14 Alertas Recientes"}),(0,r.jsx)(i.BT,{children:"Notificaciones de los \xfaltimos 7 d\xedas"})]}),(0,r.jsxs)(i.Wu,{children:[(0,r.jsx)("div",{className:"text-3xl font-bold mb-2",children:x?"...":t.length}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:0===t.length?"Sin alertas recientes":"Alertas recibidas"}),t.length>0&&(0,r.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto custom-scrollbar",children:t.slice(0,3).map(e=>{var s;return(0,r.jsxs)("div",{className:"flex flex-col text-sm border-b border-white/5 pb-2 last:border-0",children:[(0,r.jsx)("span",{className:"font-medium text-xs",children:(null===(s=e.event)||void 0===s?void 0:s.title)||"Evento"}),(0,r.jsx)("span",{className:"text-[10px] text-muted-foreground",children:new Date(e.sentAt).toLocaleDateString()})]},e.id)})})]})]}),(0,r.jsx)(f,{})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Acciones R\xe1pidas"}),(0,r.jsx)(i.BT,{children:"Configura tu experiencia de monitoreo"})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsxs)(l.$,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>m.push("/settings"),children:[(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCCD"}),(0,r.jsx)("span",{children:"Administrar Zonas"})]}),(0,r.jsxs)(l.$,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>m.push("/settings"),children:[(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDD14"}),(0,r.jsx)("span",{children:"Preferencias de Alertas"})]}),(0,r.jsxs)(l.$,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>m.push("/"),children:[(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCCA"}),(0,r.jsx)("span",{children:"Ver Mapa en Vivo"})]}),(0,r.jsxs)(l.$,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:()=>m.push("/settings"),children:[(0,r.jsx)("span",{className:"text-2xl",children:"⚙️"}),(0,r.jsx)("span",{children:"Configuraci\xf3n General"})]})]})})]})]})]})})}},7641:(e,s,t)=>{"use strict";t.d(s,{AuthGuard:()=>c});var r=t(5155),a=t(2115),n=t(6046),i=t(5502),l=t(631);function c(e){let{children:s,redirectTo:t="/login",requireAuth:c=!0}=e,{user:o,loading:d}=(0,i.As)(),u=(0,n.useRouter)();return((0,a.useEffect)(()=>{d||(c&&!o?u.push(t):!c&&o&&u.push("/"))},[o,d,c,t,u]),d)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)(l.k,{text:"Verificando sesi\xf3n..."})}):c&&!o||!c&&o?null:(0,r.jsx)(r.Fragment,{children:s})}},2167:(e,s,t)=>{"use strict";t.d(s,{M:()=>l});var r=t(5155),a=t(2115),n=t(6046),i=t(5502);function l(){let{signIn:e,loading:s}=(0,i.As)(),t=(0,n.useRouter)(),[l,c]=(0,a.useState)(!1),o=async()=>{try{c(!0),await e(),t.push("/")}catch(e){console.error("Error during login:",e)}finally{c(!1)}},d=l||s;return(0,r.jsxs)("button",{onClick:o,disabled:d,className:"flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-[#E8E8F0] hover:text-[#D4B57A] transition-colors disabled:opacity-50",children:[d?(0,r.jsx)("span",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):(0,r.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,r.jsx)("span",{children:d?"...":"Entrar"})]})}},7167:(e,s,t)=>{"use strict";t.d(s,{Header:()=>h});var r=t(5155),a=t(2115),n=t(8173),i=t.n(n),l=t(5565),c=t(6046),o=t(5502),d=t(2167),u=t(5812);function h(){let{user:e}=(0,o.As)(),s=(0,c.usePathname)(),[t,n]=(0,a.useState)(!1),h=e=>s===e,x=[{href:"/",label:"Mapa",requiresAuth:!1},{href:"/dashboard",label:"Panel",requiresAuth:!0},{href:"/settings",label:"Config",requiresAuth:!0}].filter(s=>!s.requiresAuth||e);return(0,r.jsxs)("header",{className:"sticky top-0 z-50 w-full border-b border-[#4A5060]/30 bg-[#0D0E14]/90 backdrop-blur-md",children:[(0,r.jsxs)("div",{className:"max-w-6xl mx-auto flex h-16 items-center justify-between px-4",children:[(0,r.jsxs)(i(),{href:"/",className:"flex items-center gap-2 group",children:[(0,r.jsx)("div",{className:"relative w-9 h-9 transition-transform group-hover:scale-105",children:(0,r.jsx)(l.default,{src:"/logo.svg",alt:"Sentinel Logo",fill:!0,className:"object-contain drop-shadow-[0_0_10px_rgba(212,181,122,0.3)]"})}),(0,r.jsx)("span",{className:"font-semibold text-[#D4B57A] tracking-wider hidden sm:block",children:"SENTINEL"})]}),(0,r.jsx)("nav",{className:"hidden md:flex items-center gap-1",children:x.map(e=>(0,r.jsx)(i(),{href:e.href,className:"px-3 py-1.5 rounded-md text-sm transition-colors ".concat(h(e.href)?"bg-[#D4B57A]/10 text-[#D4B57A]":"text-[#8890A0] hover:text-[#E8E8F0] hover:bg-[#1A1B22]"),children:e.label},e.href))}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[e?(0,r.jsx)(u.B,{}):(0,r.jsx)(d.M,{}),(0,r.jsx)("button",{onClick:()=>n(!t),className:"md:hidden p-2 text-[#8890A0] hover:text-[#E8E8F0]","aria-label":"Menu",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t?(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),t&&(0,r.jsx)("nav",{className:"md:hidden border-t border-[#4A5060]/30 bg-[#0D0E14] p-4 space-y-1",children:x.map(e=>(0,r.jsx)(i(),{href:e.href,onClick:()=>n(!1),className:"block px-3 py-2 rounded-md text-sm ".concat(h(e.href)?"bg-[#D4B57A]/10 text-[#D4B57A]":"text-[#8890A0] hover:text-[#E8E8F0]"),children:e.label},e.href))})]})}},5633:(e,s,t)=>{"use strict";t.d(s,{E:()=>n});var r=t(5155),a=t(1684);function n(e){let{className:s,variant:t="plasma",...n}=e;return(0,r.jsx)("span",{className:(0,a.cn)("inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border",{plasma:"bg-[#D4B57A]/15 text-[#D4B57A] border-[#D4B57A]/30",mist:"bg-[#7088A0]/15 text-[#7088A0] border-[#7088A0]/30",success:"bg-[#4ADE80]/15 text-[#4ADE80] border-[#4ADE80]/30",warning:"bg-[#FBBF24]/15 text-[#FBBF24] border-[#FBBF24]/30",danger:"bg-[#F87171]/15 text-[#F87171] border-[#F87171]/30",secondary:"bg-[#4A5060]/30 text-[#8890A0] border-[#4A5060]/40"}[t],s),...n})}},631:(e,s,t)=>{"use strict";t.d(s,{k:()=>n});var r=t(5155);function a(e){let{size:s="md",className:t=""}=e;return(0,r.jsx)("div",{className:"".concat({sm:"w-4 h-4 border-2",md:"w-6 h-6 border-2",lg:"w-8 h-8 border-3"}[s]," border-[#D4B57A] border-t-transparent rounded-full animate-spin ").concat(t)})}function n(e){let{text:s}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3 py-8",children:[(0,r.jsx)(a,{size:"lg"}),s&&(0,r.jsx)("p",{className:"text-[#8890A0] text-sm",children:s})]})}},4232:(e,s,t)=>{"use strict";t.d(s,{o:()=>i});var r=t(2115),a=t(5502),n=t(3401);function i(){let{user:e}=(0,a.As)(),[s,t]=(0,r.useState)([]),[i,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),d=null==e?void 0:e.uid,u=(0,r.useCallback)(async()=>{if(!d){t([]);return}try{l(!0),o(null);let e=await (0,n.lT)(d);t(e)}catch(e){console.error("Error loading zones:",e),o("Error al cargar zonas")}finally{l(!1)}},[d]);(0,r.useEffect)(()=>{u()},[u]);let h=(0,r.useCallback)(async e=>{if(!d)throw Error("Usuario no autenticado");try{o(null);let s=await (0,n.HT)(d,e);return await u(),s}catch(e){throw console.error("Error creating zone:",e),o("Error al crear zona"),e}},[d,u]),x=(0,r.useCallback)(async(e,s)=>{if(!d)throw Error("Usuario no autenticado");try{o(null),await (0,n.PH)(d,e,s),await u()}catch(e){throw console.error("Error updating zone:",e),o("Error al actualizar zona"),e}},[d,u]),m=(0,r.useCallback)(async e=>{if(!d)throw Error("Usuario no autenticado");try{o(null),await (0,n.ZV)(d,e),await u()}catch(e){throw console.error("Error deleting zone:",e),o("Error al eliminar zona"),e}},[d,u]),f=(0,r.useCallback)(async(e,s)=>x(e,{isActive:s}),[x]),p=s.filter(e=>e.isActive),j=(0,r.useCallback)(function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return p.some(r=>(function(e,s,t,r){let a=(e-t)*Math.PI/180,n=(s-r)*Math.PI/180,i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(t*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371})(e,s,r.location.lat,r.location.lng)<=r.radiusKm+t)},[p]);return{zones:s,activeZones:p,loading:i,error:c,createZone:h,updateZone:x,removeZone:m,toggleZone:f,refresh:u,isLocationInUserZones:j}}}},e=>{var s=s=>e(e.s=s);e.O(0,[135,563,445,181,465,58,441,517,358],()=>s(119)),_N_E=e.O()}]);